<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Assistant - Comprehensive Test</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        background: white;
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .header h1 {
        color: #667eea;
        margin-bottom: 10px;
      }

      .header p {
        color: #666;
        font-size: 14px;
      }

      .test-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .test-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .test-card h3 {
        color: #667eea;
        margin-bottom: 15px;
        font-size: 16px;
      }

      .test-card p {
        color: #666;
        font-size: 13px;
        margin-bottom: 15px;
        line-height: 1.6;
      }

      .buttons {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      button {
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
        transition: all 0.3s ease;
        text-align: left;
      }

      .btn-primary {
        background: #667eea;
        color: white;
      }

      .btn-primary:hover {
        background: #5568d3;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
        background: #764ba2;
        color: white;
      }

      .btn-secondary:hover {
        background: #653a8f;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(118, 75, 162, 0.4);
      }

      .btn-success {
        background: #48bb78;
        color: white;
      }

      .btn-success:hover {
        background: #38a169;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(72, 187, 120, 0.4);
      }

      .output-section {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-top: 20px;
      }

      .output-section h2 {
        color: #667eea;
        margin-bottom: 15px;
        font-size: 18px;
      }

      .output-box {
        background: #f7fafc;
        border: 1px solid #e2e8f0;
        border-radius: 5px;
        padding: 15px;
        max-height: 400px;
        overflow-y: auto;
        font-family: "Monaco", "Courier New", monospace;
        font-size: 12px;
        white-space: pre-wrap;
        word-wrap: break-word;
        margin-bottom: 15px;
      }

      .status-badge {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 3px;
        font-size: 12px;
        font-weight: 600;
        margin-bottom: 10px;
      }

      .status-success {
        background: #c6f6d5;
        color: #22543d;
      }

      .status-error {
        background: #fed7d7;
        color: #742a2a;
      }

      .status-info {
        background: #bee3f8;
        color: #2c5282;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .test-results {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .result-item {
        background: #f7fafc;
        padding: 15px;
        border-radius: 5px;
        text-align: center;
        border-left: 4px solid #e2e8f0;
      }

      .result-item.pass {
        border-left-color: #48bb78;
        background: #f0fff4;
      }

      .result-item.fail {
        border-left-color: #f56565;
        background: #fff5f5;
      }

      .result-item .label {
        font-size: 12px;
        color: #666;
        margin-bottom: 5px;
      }

      .result-item .value {
        font-size: 14px;
        font-weight: 600;
        color: #2d3748;
      }

      .result-item.pass .value {
        color: #22863a;
      }

      .result-item.fail .value {
        color: #cb2431;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ðŸš€ AI Assistant - Comprehensive System Test</h1>
        <p>Test backend API, frontend services, and AI Assistant integration</p>
      </div>

      <div class="test-grid">
        <!-- Backend Connection Test -->
        <div class="test-card">
          <h3>ðŸ”Œ Backend Connection</h3>
          <p>
            Test if the Node.js backend is running and accessible at
            http://localhost:3000
          </p>
          <div class="buttons">
            <button class="btn-primary" onclick="testBackendConnection()">
              Test Connection
            </button>
          </div>
        </div>

        <!-- API Endpoints Test -->
        <div class="test-card">
          <h3>ðŸ“¡ API Endpoints</h3>
          <p>
            Test critical API endpoints: /view-group-tour, /tour-type-list,
            /city-list
          </p>
          <div class="buttons">
            <button class="btn-primary" onclick="testViewGroupTour()">
              Test /view-group-tour
            </button>
            <button class="btn-secondary" onclick="testTourTypes()">
              Test /tour-type-list
            </button>
            <button class="btn-secondary" onclick="testCityList()">
              Test /city-list
            </button>
          </div>
        </div>

        <!-- AI Assistant Search Test -->
        <div class="test-card">
          <h3>ðŸ¤– AI Assistant Search</h3>
          <p>Test AI Assistant search functionality with sample queries</p>
          <div class="buttons">
            <button class="btn-success" onclick="testAISearch('Dubai')">
              Search "Dubai"
            </button>
            <button class="btn-success" onclick="testAISearch('Egypt')">
              Search "Egypt"
            </button>
            <button class="btn-success" onclick="testAISearch('5D-4N')">
              Search "5D-4N"
            </button>
          </div>
        </div>

        <!-- Database Status Test -->
        <div class="test-card">
          <h3>ðŸ’¾ Database Status</h3>
          <p>Check if tours exist in the database</p>
          <div class="buttons">
            <button class="btn-primary" onclick="testDatabaseStatus()">
              Check Database
            </button>
          </div>
        </div>

        <!-- Full Diagnostic -->
        <div class="test-card">
          <h3>ðŸ“Š Full Diagnostic Report</h3>
          <p>Run comprehensive diagnostic to identify any issues</p>
          <div class="buttons">
            <button class="btn-success" onclick="runFullDiagnostic()">
              Run Full Diagnostic
            </button>
            <button class="btn-secondary" onclick="clearOutput()">
              Clear Output
            </button>
          </div>
        </div>

        <!-- Documentation -->
        <div class="test-card">
          <h3>ðŸ“š Quick Reference</h3>
          <p>Links to key documentation files</p>
          <div class="buttons">
            <button class="btn-primary" onclick="showDocumentation()">
              Show Documentation
            </button>
          </div>
        </div>
      </div>

      <!-- Output Section -->
      <div class="output-section">
        <h2>Test Results & Output</h2>
        <div id="status-badges"></div>
        <div class="output-box" id="output">
          Ready to run tests. Click any button to start...
        </div>
        <div class="test-results" id="test-results"></div>
      </div>
    </div>

    <script>
      const API_BASE = "http://localhost:3000/api";
      let testResults = {};

      function log(message, type = "info") {
        const output = document.getElementById("output");
        const timestamp = new Date().toLocaleTimeString();
        const prefix =
          type === "error" ? "âŒ" : type === "success" ? "âœ…" : "â„¹ï¸";
        output.textContent += `\n[${timestamp}] ${prefix} ${message}`;
        output.parentElement.scrollTop = output.parentElement.scrollHeight;
      }

      function clearOutput() {
        document.getElementById("output").textContent =
          "Output cleared. Ready for new tests...";
        document.getElementById("test-results").innerHTML = "";
        document.getElementById("status-badges").innerHTML = "";
        testResults = {};
      }

      function addResult(name, status, details = "") {
        testResults[name] = { status, details };
        updateResultsDisplay();
      }

      function updateResultsDisplay() {
        const resultsDiv = document.getElementById("test-results");
        resultsDiv.innerHTML = Object.entries(testResults)
          .map(
            ([name, result]) => `
                    <div class="result-item ${
                      result.status === "pass" ? "pass" : "fail"
                    }">
                        <div class="label">${name}</div>
                        <div class="value">${
                          result.status === "pass" ? "âœ“ PASS" : "âœ— FAIL"
                        }</div>
                        ${
                          result.details
                            ? `<div class="label" style="margin-top:5px; font-size:11px;">${result.details}</div>`
                            : ""
                        }
                    </div>
                `
          )
          .join("");
      }

      async function testBackendConnection() {
        log("Testing backend connection to " + API_BASE + "...");
        try {
          const response = await fetch(API_BASE + "/tour-type-list", {
            headers: { token: "test-token" },
          });
          if (response.status !== 401 && response.status !== 200) {
            throw new Error(`Unexpected status: ${response.status}`);
          }
          log("âœ… Backend is running and responding!", "success");
          addResult("Backend Connection", "pass", "Server running");
        } catch (error) {
          log("âŒ Backend connection failed: " + error.message, "error");
          addResult("Backend Connection", "fail", error.message);
        }
      }

      async function testViewGroupTour() {
        log("Testing /view-group-tour endpoint...");
        try {
          const token = localStorage.getItem("token") || "demo-token";
          const response = await fetch(
            API_BASE + "/view-group-tour?page=1&perPage=5",
            {
              headers: { token: token },
            }
          );
          const data = await response.json();

          if (response.ok) {
            log(`âœ… Received ${data.data?.length || 0} group tours`, "success");
            log("Response structure: " + JSON.stringify(data, null, 2));
            addResult(
              "Group Tours API",
              "pass",
              `${data.data?.length || 0} tours found`
            );
          } else {
            log("âš ï¸ API returned error: " + JSON.stringify(data), "error");
            addResult(
              "Group Tours API",
              "fail",
              data.message || "Unknown error"
            );
          }
        } catch (error) {
          log("âŒ Error: " + error.message, "error");
          addResult("Group Tours API", "fail", error.message);
        }
      }

      async function testTourTypes() {
        log("Testing /tour-type-list endpoint...");
        try {
          const token = localStorage.getItem("token") || "demo-token";
          const response = await fetch(API_BASE + "/tour-type-list", {
            headers: { token: token },
          });
          const data = await response.json();

          if (response.ok) {
            log(`âœ… Received ${data.data?.length || 0} tour types`, "success");
            addResult(
              "Tour Types API",
              "pass",
              `${data.data?.length || 0} types available`
            );
          } else {
            log("âš ï¸ API error: " + JSON.stringify(data), "error");
            addResult("Tour Types API", "fail", "Failed to fetch");
          }
        } catch (error) {
          log("âŒ Error: " + error.message, "error");
          addResult("Tour Types API", "fail", error.message);
        }
      }

      async function testCityList() {
        log("Testing /city-list endpoint...");
        try {
          const token = localStorage.getItem("token") || "demo-token";
          const response = await fetch(API_BASE + "/city-list", {
            headers: { token: token },
          });
          const data = await response.json();

          if (response.ok) {
            log(`âœ… Received ${data.data?.length || 0} cities`, "success");
            addResult(
              "City List API",
              "pass",
              `${data.data?.length || 0} cities available`
            );
          } else {
            log("âš ï¸ API error: " + JSON.stringify(data), "error");
            addResult("City List API", "fail", "Failed to fetch");
          }
        } catch (error) {
          log("âŒ Error: " + error.message, "error");
          addResult("City List API", "fail", error.message);
        }
      }

      async function testAISearch(query) {
        log(`ðŸ¤– Testing AI Assistant search for: "${query}"`);
        try {
          const token = localStorage.getItem("token") || "demo-token";
          const response = await fetch(
            API_BASE +
              `/view-group-tour?tourName=${encodeURIComponent(
                query
              )}&perPage=10`,
            {
              headers: { token: token },
            }
          );
          const data = await response.json();

          if (response.ok && data.data?.length > 0) {
            log(
              `âœ… Found ${data.data.length} results for "${query}"`,
              "success"
            );
            log(
              "Sample results: " +
                JSON.stringify(data.data.slice(0, 2), null, 2)
            );
            addResult(
              `Search "${query}"`,
              "pass",
              `${data.data.length} results`
            );
          } else {
            log(`âš ï¸ No results found for "${query}"`, "error");
            addResult(`Search "${query}"`, "fail", "No results");
          }
        } catch (error) {
          log("âŒ Search error: " + error.message, "error");
          addResult(`Search "${query}"`, "fail", error.message);
        }
      }

      async function testDatabaseStatus() {
        log("Checking database status...");
        try {
          const token = localStorage.getItem("token") || "demo-token";
          const response = await fetch(
            API_BASE + "/view-group-tour?perPage=1",
            {
              headers: { token: token },
            }
          );
          const data = await response.json();

          const totalTours = data.total || 0;
          if (totalTours > 0) {
            log(`âœ… Database contains ${totalTours} group tours`, "success");
            addResult("Database Status", "pass", `${totalTours} tours in DB`);
          } else {
            log("âš ï¸ No tours found in database", "error");
            addResult("Database Status", "fail", "No tours in database");
          }
        } catch (error) {
          log("âŒ Database check failed: " + error.message, "error");
          addResult("Database Status", "fail", error.message);
        }
      }

      async function runFullDiagnostic() {
        log("ðŸ” Running full diagnostic...\n");
        await testBackendConnection();
        await new Promise((r) => setTimeout(r, 500));
        await testViewGroupTour();
        await new Promise((r) => setTimeout(r, 500));
        await testTourTypes();
        await new Promise((r) => setTimeout(r, 500));
        await testCityList();
        await new Promise((r) => setTimeout(r, 500));
        await testDatabaseStatus();
        log("\nâœ… Diagnostic complete!");
      }

      function showDocumentation() {
        log("ðŸ“š AI Assistant System Documentation\n");
        log("KEY FILES:");
        log(
          "- Backend: D:\\Waari\\waari-nodejs\\src\\routes\\groupTourRoute.js"
        );
        log(
          "- Frontend: d:\\Waari\\waari-reactjs\\src\\services\\TripService.js"
        );
        log(
          "- Transformer: d:\\Waari\\waari-reactjs\\src\\services\\TripTransformer.js"
        );
        log("\nFIXES APPLIED:");
        log("âœ… Backend /view-group-tour: Added JOINs with tourtype table");
        log("âœ… Backend /view-group-tour: Implemented proper filtering");
        log("âœ… Backend /view-group-tour: Added pagination support");
        log("âœ… Frontend TripService: Added data transformation");
        log("âœ… Frontend TripService: Enhanced error handling");
        log("\nTO TEST:");
        log('1. Click "Run Full Diagnostic"');
        log("2. Check all items show âœ“ PASS");
        log("3. Try AI Assistant search in the app");
        log("\nNEXT STEPS:");
        log("If any test fails, check the error message above");
      }

      // Auto-run basic checks on load
      window.addEventListener("load", () => {
        log("AI Assistant Test Suite Loaded");
        log("Click buttons to run tests...");
      });
    </script>
  </body>
</html>
